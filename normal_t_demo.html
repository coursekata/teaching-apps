<!DOCTYPE html>
<!--
To set a specific standard error (SE), add se=VALUE to the URL.
Example: sampling_t_normal.html?se=3.25
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sampling Distribution with Normal and t Overlays</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui;
      margin: 24px;
      color: #333;
    }

    #plot {
      max-width: 900px;
      height: 480px;
      margin-left: auto;
      margin-right: auto;
    }

    #controls {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: center;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }

    #dfLabel {
      font-weight: 600;
      margin-left: 4px;
    }

    .checkbox label {
      cursor: pointer;
      font-size: 15px;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
    }

    .slider-wrapper input[type="range"] {
      width: 180px;
    }
  </style>
</head>

<body>

<div id="plot"></div>

<div id="controls">
  <label class="checkbox">
    <input type="checkbox" id="showNormal" checked>
    Normal model
  </label>

  <label class="checkbox">
    <input type="checkbox" id="showT" checked>
    t model
  </label>

  <div class="slider-wrapper">
    <span>df for t:</span>
    <input type="range" id="dfSlider" min="2" max="60" step="1" value="15">
    <span id="dfLabel">15</span>
  </div>
</div>

<script>
  // ---------- SE from URL ----------
  const params  = new URLSearchParams(window.location.search);
  const seParam = parseFloat(params.get("se"));
  const SE      = (Number.isFinite(seParam) && seParam > 0) ? seParam : 1;

  // ---------- Utilities ----------
  function rnorm(n, mean = 0, sd = 1) {
    const arr = [];
    for (let i = 0; i < n; i++) {
      let u = 0, v = 0;
      while (u === 0) u = Math.random();
      while (v === 0) v = Math.random();
      const z = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
      arr.push(mean + sd * z);
    }
    return arr;
  }

  function logGamma(z) {
    const g = 7;
    const p = [
      0.99999999999980993, 676.5203681218851, -1259.1392167224028,
      771.32342877765313, -176.61502916214059, 12.507343278686905,
      -0.13857109526572012, 9.9843695780195716e-6,
      1.5056327351493116e-7
    ];
    if (z < 0.5) {
      return Math.log(Math.PI) - Math.log(Math.sin(Math.PI * z)) - logGamma(1 - z);
    }
    z -= 1;
    let x = p[0];
    for (let i = 1; i < p.length; i++) x += p[i] / (z + i);
    const t = z + g + 0.5;
    return 0.5 * Math.log(2 * Math.PI) + (z + 0.5) * Math.log(t) - t + Math.log(x);
  }

  function gamma(z) { return Math.exp(logGamma(z)); }

  function dnorm(x, m = 0, s = 1) {
    const z = (x - m) / s;
    return Math.exp(-0.5 * z * z) / (s * Math.sqrt(2 * Math.PI));
  }

  function dt(x, df) {
    const v = df;
    const c = gamma((v + 1) / 2) /
              (Math.sqrt(v * Math.PI) * gamma(v / 2));
    return c * Math.pow(1 + (x * x) / v, -(v + 1) / 2);
  }

  // ---------- Data ----------
  const sample = rnorm(2000, 0, SE);

  const xMin  = -4 * SE;
  const xMax  =  4 * SE;
  const step  = (xMax - xMin) / 160;
  const xGrid = [];
  for (let x = xMin; x <= xMax; x += step) xGrid.push(x);

  function makeNormal() { return xGrid.map(x => dnorm(x, 0, SE)); }
  function makeT(df)   { return xGrid.map(x => dt(x / SE, df) / SE); }

  // ---------- Histogram ----------
  const histTrace = {
    x: sample,
    type: "histogram",
    histnorm: "probability density",
    name: "Simulated Sampling Distribution",
    marker: {
      color: "rgba(207,224,255,0.7)",
      line: { color: "#355e9a", width: 1.6 }
    },
    opacity: 1,
    autobinx: false,
    xbins: { start: xMin, end: xMax, size: (xMax - xMin) / 22 }
  };

  // ---------- Curves ----------
  let currentDf = 15;
  let tY        = makeT(currentDf);
  const normalY = makeNormal();

  const normalTrace = {
    x: xGrid, y: normalY,
    type: "scatter", mode: "lines",
    name: "Normal model",
    line: { color: "green", width: 3, dash: "dash" },
    visible: true
  };

  const tTrace = {
    x: xGrid, y: tY,
    type: "scatter", mode: "lines",
    name: "t model",
    line: { color: "blue", width: 3 },
    visible: true
  };

  // ---------- Layout ----------
  const layout = {
    barmode: "overlay",
    xaxis: {
      title: { text: "b\u2081", font: { size: 20 } },
      range: [xMin, xMax],
      zeroline: false,
      ticklabelposition: "inside",   /* moves numbers up */
      tickfont: { size: 13 },
	  ticks: "",       // â† removes tick marks entirely
	  ticklen: 0,      // redundant but safe
      title_standoff: 4
    },
    yaxis: { title: "Density" },
    margin: { t: 5, r: 20, l: 60, b: 28 },

    legend: {
      x: 0.67,                       /* moved 30px left */
      y: 0.85,
      xanchor: "left",
      yanchor: "top",
      bgcolor: "rgba(255,255,255,0.85)",
      bordercolor: "rgba(0,0,0,0.15)",
      borderwidth: 1
    },
    showlegend: true
  };

  Plotly.newPlot("plot", [histTrace, normalTrace, tTrace], layout, {
    responsive: true
  });

  // ---------- Controls ----------
  document.getElementById("showNormal").addEventListener("change", e =>
    Plotly.restyle("plot", { visible: e.target.checked }, [1])
  );

  document.getElementById("showT").addEventListener("change", e =>
    Plotly.restyle("plot", { visible: e.target.checked }, [2])
  );

  const dfSlider = document.getElementById("dfSlider");
  const dfLabel  = document.getElementById("dfLabel");

  dfSlider.addEventListener("input", e => {
    currentDf = parseInt(e.target.value);
    dfLabel.textContent = currentDf;
    tY = makeT(currentDf);
    Plotly.restyle("plot", { y: [tY] }, [2]);
  });
</script>

</body>
</html>
