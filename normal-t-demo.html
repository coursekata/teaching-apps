<!--
normal-t-demo.html
------------------

USING SE AND DF PARAMETERS
--------------------------
You can control the standard error (SE) and the starting
degrees of freedom (df) via URL parameters.

Examples:

  normal-t-demo.html?se=2.5
  normal-t-demo.html?df=12
  normal-t-demo.html?se=2.5&df=12

Defaults:
  SE defaults to 1 if omitted or invalid.
  df defaults to 15 if omitted or invalid.

This app displays:
  • A simulated sampling distribution of b₁
  • A normal model using SE
  • A t model using SE and df (adjustable via slider)
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Normal vs t Demo</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui;
      margin: 16px 24px;
      color: #333;
    }

    /* Outer container controls total height: plot + controls */
    #outer {
      max-width: 900px;
      height: 360px;                  /* adjust this if you want taller/shorter */
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: space-between; /* plot at top, controls at bottom */
    }

    #plot {
      width: 100%;
      flex: 1 1 auto;                 /* plot takes remaining vertical space */
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: center;
      padding-top: 4px;
    }

    #dfLabel {
      font-weight: 600;
      margin-left: 4px;
    }

    .checkbox label {
      cursor: pointer;
      font-size: 15px;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
    }

    .slider-wrapper input[type="range"] {
      width: 180px;
    }
  </style>
</head>

<body>

<div id="outer">
  <div id="plot"></div>

  <div id="controls">
    <label class="checkbox">
      <input type="checkbox" id="showNormal" checked>
      Normal model
    </label>

    <label class="checkbox">
      <input type="checkbox" id="showT">
      t model
    </label>

    <div class="slider-wrapper">
      <span>df for t:</span>
      <input type="range" id="dfSlider" min="2" max="60" step="1" value="15">
      <span id="dfLabel">15</span>
    </div>
  </div>
</div>

<script>
  // -------------------------------------------------------------
  // Get SE and df from URL parameters (?se=... & ?df=...)
  // -------------------------------------------------------------
  const params = new URLSearchParams(window.location.search);

  // SE parameter
  const seParam = parseFloat(params.get("se"));
  const SE = (Number.isFinite(seParam) && seParam > 0) ? seParam : 1;

  // df parameter
  const dfParam = parseInt(params.get("df"), 10);
  let currentDf = (Number.isInteger(dfParam) && dfParam >= 2 && dfParam <= 200)
    ? dfParam
    : 15;

  // -------------------------------------------------------------
  // Utilities: rnorm, gamma, t, normal pdf
  // -------------------------------------------------------------
  function rnorm(n, mean = 0, sd = 1) {
    const arr = [];
    for (let i = 0; i < n; i++) {
      let u = 0, v = 0;
      while (u === 0) u = Math.random();
      while (v === 0) v = Math.random();
      const z = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
      arr.push(mean + sd * z);
    }
    return arr;
  }

  function logGamma(z) {
    const g = 7;
    const p = [
      0.99999999999980993,
      676.5203681218851,
      -1259.1392167224028,
      771.32342877765313,
      -176.61502916214059,
      12.507343278686905,
      -0.13857109526572012,
      9.9843695780195716e-6,
      1.5056327351493116e-7
    ];
    if (z < 0.5) {
      return Math.log(Math.PI) - Math.log(Math.sin(Math.PI * z)) - logGamma(1 - z);
    }
    z -= 1;
    let x = p[0];
    for (let i = 1; i < p.length; i++) x += p[i] / (z + i);
    const t = z + g + 0.5;
    return 0.5 * Math.log(2 * Math.PI)
           + (z + 0.5) * Math.log(t)
           - t
           + Math.log(x);
  }

  const gamma = z => Math.exp(logGamma(z));

  const dnorm = (x, m = 0, s = 1) =>
    Math.exp(-0.5 * ((x - m) / s) ** 2) / (s * Math.sqrt(2 * Math.PI));

  function dt(x, df) {
    const c = gamma((df + 1) / 2) /
              (Math.sqrt(df * Math.PI) * gamma(df / 2));
    return c * Math.pow(1 + (x * x) / df, -(df + 1) / 2);
  }

  // -------------------------------------------------------------
  // Generate sampling distribution of b1 (normal with sd = SE)
  // -------------------------------------------------------------
  const sample = rnorm(2000, 0, SE);

  const xMin = -4 * SE;
  const xMax =  4 * SE;
  const step = (xMax - xMin) / 160;
  const xGrid = [];
  for (let x = xMin; x <= xMax; x += step) xGrid.push(x);

  const makeNormal = () => xGrid.map(x => dnorm(x, 0, SE));
  const makeT      = df => xGrid.map(x => dt(x / SE, df) / SE);

  // -------------------------------------------------------------
  // Histogram trace
  // -------------------------------------------------------------
  const histTrace = {
    x: sample,
    type: "histogram",
    histnorm: "probability density",
    name: "Simulated Sampling Distribution",
    marker: {
      color: "rgba(207,224,255,0.7)",
      line: { color: "#355e9a", width: 1.6 }
    },
    opacity: 1,
    autobinx: false,
    xbins: { start: xMin, end: xMax, size: (xMax - xMin) / 22 }
  };

  // -------------------------------------------------------------
  // Model curves
  // -------------------------------------------------------------
  let tY = makeT(currentDf);
  const normalY = makeNormal();

  const normalTrace = {
    x: xGrid,
    y: normalY,
    type: "scatter",
    mode: "lines",
    name: "Normal model",
    line: { color: "red", width: 3, dash: "dash" },
    visible: true
  };

  const tTrace = {
    x: xGrid,
    y: tY,
    type: "scatter",
    mode: "lines",
    name: "t model",
    line: { color: "blue", width: 3 },
    visible: false
  };

  // -------------------------------------------------------------
  // Layout with inset title & no x-axis label
  // -------------------------------------------------------------
  const layout = {
    barmode: "overlay",

    xaxis: {
      title: "",
      range: [xMin, xMax],
      zeroline: false,
      ticklabelposition: "outside",
      tickfont: { size: 13, color: "#000" },
      ticks: "",
      ticklen: 0,
      automargin: false
    },

    yaxis: {
      title: "Density"
    },

    annotations: [
      {
        text: "<b>Distribution of b\u2081</b>",
        x: 0.02,
        y: 0.88,
        xref: "paper",
        yref: "paper",
        showarrow: false,
        font: { size: 18, color: "#222" },
        align: "left"
      }
    ],

    margin: { t: 5, r: 20, l: 60, b: 18 },

    legend: {
      x: 0.67,
      y: 0.88,
      xanchor: "left",
      yanchor: "top",
      bgcolor: "rgba(255,255,255,0.85)",
      bordercolor: "rgba(0,0,0,0.15)",
      borderwidth: 1
    },

    showlegend: true
  };

  Plotly.newPlot("plot", [histTrace, normalTrace, tTrace], layout, {
    responsive: true
  });

  // -------------------------------------------------------------
  // Controls
  // -------------------------------------------------------------
  document.getElementById("showNormal").addEventListener("change", e => {
    Plotly.restyle("plot", { visible: e.target.checked }, [1]);
  });

  document.getElementById("showT").addEventListener("change", e => {
    Plotly.restyle("plot", { visible: e.target.checked }, [2]);
  });

  const dfSlider = document.getElementById("dfSlider");
  const dfLabel  = document.getElementById("dfLabel");

  // initialize slider from URL df
  dfSlider.value = currentDf;
  dfLabel.textContent = currentDf;

  dfSlider.addEventListener("input", e => {
    currentDf = parseInt(e.target.value, 10);
    dfLabel.textContent = currentDf;
    tY = makeT(currentDf);
    Plotly.restyle("plot", { y: [tY] }, [2]);
  });

</script>

</body>
</html>
